# Filesystem Agent Example
# An agent that can read, write, and analyze files using the filesystem MCP server
#
# This example uses the official @modelcontextprotocol/server-filesystem MCP server.
# The server restricts file operations to the specified directory (/tmp/acp-filesystem-example).
#
# Note: Method names (read_file, write_file, list_directory) are standard but may vary
# by server implementation. Verify method names by checking the server documentation
# or using an MCP inspector tool.

version: "0.1"

project:
  name: filesystem-agent

providers:
  llm:
    openai:
      api_key: env:OPENAI_API_KEY
      default_params:
        temperature: 0.3
        max_tokens: 4000

servers:
  - name: filesystem
    type: mcp
    transport: stdio
    command:
      - npx
      - "@modelcontextprotocol/server-filesystem"
      - /path/to/allowed/directory
    # No auth needed for filesystem server

capabilities:
  - name: read_file
    server: filesystem
    method: read_file
    side_effect: read

  - name: write_file
    server: filesystem
    method: write_file
    side_effect: write

  - name: list_directory
    server: filesystem
    method: list_directory
    side_effect: read

policies:
  - name: filesystem_policy
    budgets:
      max_cost_usd_per_run: 0.50
      max_capability_calls: 20
      timeout_seconds: 120

agents:
  - name: file_assistant
    provider: openai
    model:
      preference: gpt-4o-mini
      fallback: gpt-4o
    params:
      temperature: 0.3
    instructions: |
      You are a helpful file assistant. You can read, write, and analyze files.
      
      When working with files:
      - Read files to understand their content
      - Write files with clear, well-formatted content
      - List directories to explore file structure
      - Always be careful with file operations
      
      Provide clear summaries of file contents when asked.
    allow:
      - read_file
      - write_file
      - list_directory
    policy: filesystem_policy

workflows:
  - name: read_and_summarize
    entry: read
    steps:
      - id: read
        type: call
        capability: read_file
        args:
          path: $input.file_path
        save_as: file_content
        next: summarize

      - id: summarize
        type: llm
        agent: file_assistant
        input:
          file_path: $input.file_path
          content: $state.file_content
          task: $input.task
        save_as: summary
        next: end

      - id: end
        type: end

  - name: write_file
    entry: prepare
    steps:
      - id: prepare
        type: llm
        agent: file_assistant
        input:
          file_path: $input.file_path
          instructions: $input.instructions
        save_as: file_data
        next: write

      - id: write
        type: call
        capability: write_file
        args:
          path: $input.file_path
          contents: $state.file_data.response
        save_as: result
        next: end

      - id: end
        type: end

  - name: list_and_read
    entry: list
    steps:
      - id: list
        type: call
        capability: list_directory
        args:
          path: $input.directory_path
        save_as: directory_contents
        next: analyze

      - id: analyze
        type: llm
        agent: file_assistant
        input:
          directory_path: $input.directory_path
          files: $state.directory_contents
          task: $input.task
        save_as: analysis
        next: end

      - id: end
        type: end

