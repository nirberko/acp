// Multi-Agent Example
// Multiple agents working together with conditional logic

acp {
  version = "0.1"
  project = "multi-agent-example"
}

variable "openai_api_key" {
  type        = string
  description = "OpenAI API key"
  sensitive   = true
}

variable "anthropic_api_key" {
  type        = string
  description = "Anthropic API key"
  sensitive   = true
}

provider "llm.openai" "default" {
  api_key = var.openai_api_key
  default_params {
    temperature = 0.7
    max_tokens  = 2000
  }
}

provider "llm.anthropic" "default" {
  api_key = var.anthropic_api_key
  default_params {
    temperature = 0.5
    max_tokens  = 4000
  }
}

policy "fast" {
  budgets { max_cost_usd_per_run = 0.10 }
  budgets { timeout_seconds = 30 }
}

policy "thorough" {
  budgets { max_cost_usd_per_run = 1.00 }
  budgets { timeout_seconds = 120 }
}

// OpenAI models
model "gpt4o_mini" {
  provider = provider.llm.openai.default
  id       = "gpt-4o-mini"
  params {
    temperature = 0.1
  }
}

model "gpt4o" {
  provider = provider.llm.openai.default
  id       = "gpt-4o"
  params {
    temperature = 0.7
  }
}

// Anthropic models
model "claude_sonnet" {
  provider = provider.llm.anthropic.default
  id       = "claude-sonnet-4-5-20250929"
  params {
    temperature = 0.3
    max_tokens  = 4000
  }
}

// Classifier agent - quickly categorizes tasks
agent "classifier" {
  model = model.gpt4o_mini

  instructions = <<EOF
You are a task classifier. Analyze the input and classify it.

Categories:
- "simple": Basic questions, greetings, simple tasks
- "complex": Research, analysis, multi-step tasks

Respond with ONLY the category name, nothing else.
EOF

  policy = policy.fast
}

// Quick responder - handles simple tasks
agent "quick_responder" {
  model = model.gpt4o

  instructions = <<EOF
You are a quick assistant. Give brief, helpful responses.
Keep answers concise and to the point.
EOF

  policy = policy.fast
}

// Deep analyst - handles complex tasks
agent "deep_analyst" {
  model = model.claude_sonnet

  instructions = <<EOF
You are a thorough analyst. Provide detailed, well-researched responses.

Structure your response with:
1. Summary
2. Detailed analysis
3. Recommendations

Be comprehensive and cite reasoning.
EOF

  policy = policy.thorough
}

// Smart routing workflow
workflow "smart_respond" {
  entry = step.classify

  step "classify" {
    type  = "llm"
    agent = agent.classifier

    input { task = input.task }

    output "classification" { from = result.text }

    next = step.route
  }

  step "route" {
    type      = "condition"
    condition = $state.classification.response == "simple"
    on_true   = step.quick_response
    on_false  = step.deep_response
  }

  step "quick_response" {
    type  = "llm"
    agent = agent.quick_responder

    input { task = input.task }

    output "response" { from = result.text }

    next = step.end
  }

  step "deep_response" {
    type  = "llm"
    agent = agent.deep_analyst

    input { task = input.task }

    output "response" { from = result.text }

    next = step.end
  }

  step "end" { type = "end" }
}

